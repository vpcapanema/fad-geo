<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Cadastrar Projeto - FAD</title>
    <link rel="stylesheet" href="/static/css/componentes/fad_header.css">
    <link rel="stylesheet" href="/static/css/modulos/01.Cadastro_Projeto/01.Cadastrar_projeto.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  </head>
  <body>
    {% include 'componentes/fad_header.html' %}
    {% include 'componentes/botao_logout.html' %}

    <!-- Bloco de status de sessão -->
    <div id="session-status" style="background:#e3f2fd;color:#003366;padding:10px 0;text-align:center;font-size:17px;font-weight:bold;letter-spacing:0.5px;">
      Usuário logado: {{ usuario.nome }} |
      Tempo restante da sessão: <span id="session-timer"></span>
    </div>

    <script>
    window.addEventListener("DOMContentLoaded", function() {
      var tempoRestante = parseInt("{{ tempo_restante|default(0) }}");
      var timerEl = document.getElementById('session-timer');
      function formatarTempo(segundos) {
        var min = Math.floor(segundos/60);
        var seg = segundos%60;
        return (min < 10 ? '0' : '') + min + ':' + (seg < 10 ? '0' : '') + seg;
      }
      function atualizarTimer() {
        if (tempoRestante <= 0) {
          timerEl.textContent = '00:00';
          window.location.href = '/login';
          return;
        }
        timerEl.textContent = formatarTempo(tempoRestante);
        tempoRestante--;
        setTimeout(atualizarTimer, 1000);
      }
      if (timerEl) atualizarTimer();
    });
    </script>

    <main class="box-container">
      <h2 class="form-title">Cadastrar Projeto</h2>

      <form id="formCadastroProjeto" class="form-box">
      <!-- ==================== 1. Projeto ==================== -->
      <section class="form-section" id="secao-projeto">
        <h3>1. Projeto</h3>
        <div class="form-row">
          <div class="form-field full">
            <label for="tipo_projeto">Tipo de Projeto:</label>
            <select id="tipo_projeto" name="tipo_projeto" required>
              <option value="">Selecione...</option>
              <option value="estadualizacao">Estadualização de Rodovias e Trechos Municipais</option>
              <option value="geo_obra">GEO de Obra</option>
            </select>
          </div>
          <div class="form-field full">
            <label for="nomeProjeto">Nome do Projeto:</label>
            <input type="text" id="nomeProjeto" name="nome" required />
          </div>
        </div>

        <div class="form-row confirmar-container">
          <button type="button" class="confirmar-btn hidden" id="btnConfirmarProjeto" disabled onclick="confirmarProjeto()">Confirmar</button>
        </div>

        <div id="resumoProjeto" class="resumo hidden" style="position: relative;">
          <button type="button" class="btn-editar-fad" onclick="editarProjeto()" title="Editar"><i class="fas fa-pen"></i></button>
          <p id="resumoProjetoTexto"></p>
        </div>
      </section>

      <!-- ==================== 2. Interessado ==================== -->
      <section class="form-section" id="secao-interessado">
        <h3>2. Interessado</h3>

        <!-- Campo para escolher associar/cadastrar PJ -->
        <div class="form-row">
          <div class="form-field full">
            <label for="opcaoPJ">Interessado (Pessoa Jurídica):</label>
            <select id="opcaoPJ" required>
              <option value="">Selecione...</option>
              <option value="associar">Associar PJ existente</option>
              <option value="cadastrar">Cadastrar nova PJ</option>
            </select>
          </div>
        </div>

        <!-- Box de seleção de PJ existente -->
        <div id="boxPJ" class="hidden">
          <div class="form-row">
            <div class="form-field full">
              <label for="pjSelect">Selecionar PJ:</label>
              <div class="select-with-button">
                <select id="pjSelect" required>
                  <option value="">Selecione uma PJ</option>
                  {% for pj in pjs %}
                    <option value="{{ pj.id_pj }}">{{ pj.razao_social }} ({{ pj.cnpj }})</option>
                  {% endfor %}
                </select>
                <button type="button" id="atualizarPJBtn" class="btn-atualizar-fad" title="Atualizar"><i class="fas fa-rotate-right"></i></button>

              </div>
            </div>
          </div>

          <!-- Botão confirmar PJ -->
          <div class="form-row confirmar-container">
            <button type="button" class="confirmar-btn" onclick="confirmarPJ()">Confirmar</button>
          </div>
        </div>

        <!-- Resumo do PJ selecionado -->
        <div id="resumoPJ" class="resumo hidden" style="position: relative;">
          <p><strong>✅ Razão Social:</strong> <span id="pjResumoRazao"></span></p>
          <p><strong>✅ CNPJ:</strong> <span id="pjResumoCNPJ"></span></p>
          <button type="button" class="btn-editar-fad" onclick="editarPJ()" title="Editar"><i class="fas fa-pen"></i></button>
          <input type="hidden" name="interessado_id" id="pjInputFinal" required>
        </div>
        
      </section>

      <!-- ==================== 3. Representante ==================== -->
      <section class="form-section" id="secao-representante">
        <h3>3. Representante Legal</h3>
        <div class="form-field full">
          <label>Representante (Pessoa Física):</label>
          <select id="opcaoPF" required>
            <option value="">Selecione...</option>
            <option value="associar">Associar PF existente</option>
            <option value="cadastrar">Cadastrar nova PF</option>
          </select>
        </div>

        <div id="boxPF" class="hidden">
          <div class="form-row">
            <div class="form-field full">
              <label for="pfSelect">Selecionar PF:</label>
              <div class="select-with-button">
                <select id="pfSelect" required>
                  <option value="">Selecione uma PF</option>
                  {% for pf in pfs %}
                    <option value="{{ pf.id_pf }}">{{ pf.nome }} ({{ pf.cpf }})</option>
                  {% endfor %}
                </select>
                <button type="button" id="atualizarPFBtn" class="btn-atualizar-fad" title="Atualizar">
                  <i class="fas fa-rotate-right"></i>
                </button>
              </div>
            </div>
          </div>
        
          <div class="form-row confirmar-container">
            <button type="button" class="confirmar-btn" onclick="confirmarPF()" disabled>Confirmar</button>
          </div>
        </div>
        
        
     
        <div id="resumoPF" class="resumo hidden" style="position: relative;">
          <p><strong>✅ Nome:</strong> <span id="pfResumoNome"></span></p>
          <p><strong>✅ CPF:</strong> <span id="pfResumoCPF"></span></p>
          <button type="button" class="btn-editar-fad" onclick="editarPF()" title="Editar"><i class="fas fa-pen"></i></button>
          <input type="hidden" name="representante_id" id="pfInputFinal" required>
        </div>
        
      </section>

      <!-- ==================== 4. Elemento Rodoviário ==================== -->
      <section class="form-section" id="secao-elemento-rodoviario">
        <h3>4. Elemento Rodoviário</h3>
      
        <!-- Escolha do tipo de elemento -->
        <div class="form-row">
          <div class="form-field full">
            <label for="tipo_elemento">Tipo de Elemento:</label>
            <select id="tipo_elemento" name="tipo_elemento" required>
              <option value="">Selecione...</option>
              <option value="rodovia">Rodovia</option>
              <option value="trecho">Trecho Rodoviário</option>
            </select>
          </div>
        </div>
      
        <!-- Escolha se deseja associar ou cadastrar -->
        <div class="form-row hidden" id="opcaoElementoContainer">
          <div class="form-field full">
            <label for="opcaoElemento">Opção:</label>
            <select id="opcaoElemento" required>
              <option value="">Selecione...</option>
              <option value="associar">Associar elemento existente</option>
              <option value="cadastrar">Cadastrar novo elemento</option>
            </select>
          </div>
        </div>
      
        <!-- Caixa de seleção de Rodovia -->
        <div id="boxRodovia" class="hidden">
          <div class="form-row">
            <div class="form-field full">
              <label for="rodoviaSelect">Selecionar Rodovia:</label>
              <div class="select-with-button">
                <select id="rodoviaSelect" required>
                  <option value="">Selecione uma rodovia</option>
                  {% for r in rodovias %}
                    <option value="{{ r.id }}">{{ r.codigo }} - {{ r.nome }} ({{ r.uf }})</option>
                  {% endfor %}
                </select>
                <button type="button" id="atualizarRodoviaBtn" class="btn-atualizar-fad" title="Atualizar">
                  <i class="fas fa-rotate-right"></i>
                </button>
              </div>
            </div>
          </div>
      
          <div class="form-row confirmar-container">
            <button type="button" class="confirmar-btn" onclick="confirmarRodovia()" disabled>Confirmar</button>
          </div>
        </div>
      
        <!-- Caixa de seleção de Trecho -->
        <div id="boxTrecho" class="hidden">
          <div class="form-row">
            <div class="form-field full">
              <label for="trechoSelect">Selecionar Trecho:</label>
              <div class="select-with-button">
                <select id="trechoSelect" required>
                  <option value="">Selecione um trecho</option>
                  {% for t in trechos %}
                    <option value="{{ t.id }}">{{ t.codigo }} - {{ t.denominacao }} ({{ t.municipio }})</option>
                  {% endfor %}
                </select>
                <button type="button" id="atualizarTrechoBtn" class="btn-atualizar-fad" title="Atualizar">
                  <i class="fas fa-rotate-right"></i>
                </button>
              </div>
            </div>
          </div>
      
          <div class="form-row confirmar-container">
            <button type="button" class="confirmar-btn" onclick="confirmarTrecho()" disabled>Confirmar</button>
          </div>
        </div>
      </section>
      
      </form>
    </main>

    <!-- 5. Importar Geometria -->
    <main class="box-container" id="secao-importar-geometria">
      <h2 class="form-title">5. Importar Geometria</h2>
      <p>Selecione um arquivo .zip contendo o shapefile do projeto:</p>
      <input type="file" id="fileInput" hidden />
      <div class="form-row">
        <label class="file-label" for="fileInput">Escolher Arquivo</label>
        <input type="text" id="fileName" readonly placeholder="Selecionar arquivo" />
      </div>
      <button type="button" id="uploadButton">Enviar</button>
      <div id="progressContainer" class="hidden">
        <progress id="uploadProgress" max="100" value="0"></progress>
      </div>
      <div id="resultMessage" class="hidden mensagem sucesso">✔️ Arquivo enviado com sucesso!</div>
      <div id="errorMessage" class="hidden mensagem erro">❌ Erro ao importar o arquivo.</div>
      <button id="validateButton" class="hidden">Validar Geometria</button>
      <div id="validationResult" class="hidden"></div>
    </main>

    <!-- 6. Croqui do Projeto -->
    <main class="box-container" id="secao-croqui-projeto">
      <h2 class="form-title">6. Croqui do Projeto</h2>
      <p>Área reservada para edição ou visualização do croqui do projeto.</p>
    </main>

    <!-- 7. Seleção de Módulos -->
    <main class="box-container" id="secao-selecao-modulos">
      <h2 class="form-title">7. Seleção de Módulos</h2>
      <form>
        <label><input type="checkbox" name="modulos" value="conformidade" /> Conformidade Ambiental</label><br />
        <label><input type="checkbox" name="modulos" value="multicriterio" /> Favorabilidade Multicritério</label><br />
        <label><input type="checkbox" name="modulos" value="socioeconomico" /> Favorabilidade Socioeconômica</label><br />
        <label><input type="checkbox" name="modulos" value="infraestrutura" /> Favorabilidade Infraestrutural</label>
      </form>
    </main>

    <!-- 8. Finalizar Cadastro -->
    <main class="box-container" id="secao-finalizar-cadastro">
      <h2 class="form-title">8. Finalizar Cadastro</h2>
      <form id="formSalvarFinal" action="/projeto/salvar-final" method="POST">
        <input type="hidden" name="projeto_id" id="inputProjetoId" />
        <input type="hidden" name="geometria_id" id="inputGeometriaId" />
        <input type="hidden" name="modulos" id="inputModulos" />
        <button type="submit" id="btnSalvarContinuar" class="confirmar-btn" disabled>Salvar e Continuar</button>
      </form>
    </main>

    <script src="/static/js/modulos/01.Cadastro_Projeto/01.Cadastrar_projeto.js"></script>
    <script src="/static/js/modulos/01.Cadastro_Projeto/02.Validacao_geometria.js"></script>
    <script src="/static/js/modulos/01.Cadastro_Projeto/04.Selecao_modulos.js"></script>
    <script src="/static/js/modulos/01.Cadastro_Projeto/05.Finalizar_cadastro.js"></script>
    <script src="/static/js/componentes/fad_header.js"></script>
  </body>
</html>











<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">



