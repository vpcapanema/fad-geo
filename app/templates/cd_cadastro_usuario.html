<!-- BACKUP GERADO AUTOMATICAMENTE EM 05/06/2025 -->
<!DOCTYPE html>
<html lang="pt-br">
<head>  <meta charset="UTF-8">
  <title>Cadastro - Usuário</title>
  <link rel="stylesheet" href="/static/css/componentes/fad_header.css">
  <link rel="stylesheet" href="/static/css/cd_usuario/cd_cadastro_usuario.css">
  <link rel="stylesheet" href="/static/css/cd_usuario/cd_cadastro_usuario_botoes.css">
  <link rel="stylesheet" href="/static/css/cd_usuario/cd_cadastro_usuario_componentes.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/static/css/formatacao_valores_campos/formatacao_telefone.css">
  <link rel="stylesheet" href="/static/css/formatacao_valores_campos/formatacao_email.css">
  <link rel="stylesheet" href="/static/css/formatacao_valores_campos/formatacao_email_institucional.css">
  <link rel="stylesheet" href="/static/css/formatacao_valores_campos/formatacao_ramal.css">
  <link rel="stylesheet" href="/static/css/formatacao_valores_campos/formatacao_tipo_usuario.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #eef5f9;
    }

    header.fad-header {
      text-align: center;
      background-color: #003366;
      padding: 10px;
      color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    header.fad-header h1 {
      font-size: 40px;
      margin: 0;
      text-shadow: 1px 1px 2px #00000060;
    }

    header.fad-header h2 {
      font-size: 22px;
      margin-top: 4px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #00000050;
    } 

    .form-container {
      max-width: 720px;
      margin: 30px auto;
      padding: 2rem;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .form-container > h3 {
      font-size: 22px;
      text-align: center;
      margin: 1rem 0;
    }

    .form-section {
      margin: 2rem 0;
      padding: 1rem 2.5%;
      border: 1px solid #cce0f5;
      border-radius: 8px;
      background-color: #f7fbff;
    }

    .form-section h3 {
      margin: 0 0 1rem 0;
      color: #003366;
      border-bottom: 1px solid #00336633;
      padding-bottom: .5rem;
      font-size: 18px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .form-row {
      display: flex;
      width: 100%;
      gap: 2.5%;
    }

    .form-field {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }

    input, select {
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .half       { width: 48.75%; }
    .full       { width: 100%; }    button:not(.btn-editar):not(.btn-atualizar-lista):not(.btn-confirmar-selecao):not(.btn-icone):not(.btn-pequeno):not(.confirmar-btn):not(.botao-fad) {
      display: block;
      width: 100%;
      padding: 0.9rem;
      background-color: #009933;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 2rem;
    }

    button:not(.btn-editar):not(.btn-atualizar-lista):not(.btn-confirmar-selecao):not(.btn-icone):not(.btn-pequeno):not(.confirmar-btn):not(.botao-fad):hover {
      background-color: #007a29;
    }

    .loading-msg {
      font-size: 13px;
      color: #555;
      font-style: italic;
      margin-top: 4px;
    }

    #sucessoBox {
      display: none;
      color: #0b6600;
      background: #e6ffe6;
      border: 1px solid #0b6600;
      padding: 12px;
      border-radius: 8px;
      margin-top: 18px;
      text-align: center;
      font-weight: bold;
    }

    #erroBox {
      display: none;
      color: #a80000;
      background: #ffeaea;
      border: 1px solid #a80000;
      padding: 12px;
      border-radius: 8px;
      margin-top: 18px;
      text-align: center;
      font-weight: bold;
    }

    .botao-fad {
      display: inline-block;
      padding: 0.8rem 1.5rem;
      background-color: #003366;
      color: #fff;
      text-decoration: none;
      border-radius: 6px;
      font-size: 1rem;
      transition: background-color 0.3s;
    }

    .botao-fad:hover {
      background-color: #002244;
    }

    /* Estilos específicos para seleção de PF */
    .hidden { display: none; }
    .resumo-box {
      background: #e8f4f8;
      border: 1px solid #b3d9e8;
      padding: 1rem;
      border-radius: 6px;
      margin-top: 0.5rem;
    }    .btn-icone {
      background-color: transparent;
      color: #003366;
      border: 1px solid #003366;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 18px;
      transition: all 0.3s ease;
      margin: 0 2px;
      cursor: pointer;
      min-width: 32px;
      min-height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icone:hover {
      background-color: #e3f2fd;
      color: #001a33;
      border-color: #001a33;
    }

    .btn-pequeno {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      background-color: #666;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-pequeno:hover {
      background-color: #555;
    }

    .btn-icone-fad {
      background: transparent;
      border: 1px solid #003366;
      color: #003366;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .btn-icone-fad:hover {
      background-color: #e3f2fd;
      color: #001a33;
      border-color: #001a33;
    }

    .confirmar-btn {
      background-color: #28a745;
      color: white;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      margin-top: 0.5rem;
      cursor: pointer;
    }

    .confirmar-btn:hover {
      background-color: #218838;
    }

    /* Campo de resumo estilizado como campo comum */
    .campo-resumo {
      position: relative;
      width: 100%;
    }

    .campo-resumo input {
      width: 100%;
      padding: 0.7rem;
      padding-right: 45px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #f8f9fa;
      color: #495057;
      font-size: 1rem;
    }

    .campo-resumo .btn-editar {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background-color: transparent;
      color: #003366;
      border: 1px solid #003366;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .campo-resumo .btn-editar:hover {
      background-color: #e3f2fd;
      color: #001a33;
      border-color: #001a33;
    }

    /* Estilos para validação de senha */
    .senha-regras {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      margin-top: 8px;
      color: #666;
      font-size: 11px;
      white-space: nowrap;
      overflow-x: auto;
    }

    .senha-regras div {
      margin: 0;
      white-space: nowrap;
    }

    .regra-ok {
      color: #28a745 !important;
      font-weight: bold;
    }

    .senha-msg {
      font-size: 13px;
      margin-top: 5px;
    }

    .senha-erro {
      color: #dc3545;
    }

    .senha-sucesso {
      color: #28a745;
    }

    /* Estilos para indicação de campos obrigatórios */
    .required::after {
      content: " *";
      color: #dc3545;
      font-weight: bold;
    }

    .obrigatorio-icone {
      color: #dc3545;
      font-weight: bold;
      margin-left: 3px;
      font-size: 1.1em;
      transition: color 0.2s;
    }
    .check-icone {
      color: #145a32;
      font-weight: bold;
      margin-left: 3px;
      font-size: 1.1em;
      display: none;
      transition: color 0.2s;
    }
    .campo-validado .obrigatorio-icone {
      display: none;
    }
    .campo-validado .check-icone {
      display: inline;
    }

    /* Responsividade para dispositivos móveis */
    @media (max-width: 768px) {
      .form-container {
        margin: 15px;
        padding: 1.5rem;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .half {
        width: 100%;
        margin-bottom: 1rem;
      }
      
      .form-section {
        padding: 1rem;
      }
    }

    .senha-input {
      width: 100%;
      font-size: 1rem;
      box-sizing: border-box;
    }
    #senha, #confirmar_senha {
      width: 100%;
      font-size: 1rem;
      box-sizing: border-box;
    }
    #tipo_usuario {
      width: 100%;
    }
    @media (max-width: 600px) {
      .senha-regras { flex-direction: column; gap: 2px; font-size: 10px; }
    }

    .erro-campo {
      border: 2px solid #dc3545 !important;
      background: #fff0f0 !important;
    }
  </style>
</head>
<body>
  {% include 'componentes/fad_header.html' %}
  <div class="form-container">
    <h3>Cadastro de Usuário</h3>
    <form method="post" action="/cadastro-usuario" id="usuarioForm">      <!-- INFORMAÇÕES PESSOAIS -->
      <div class="form-section">
        <h3>Informações Pessoais</h3>
        <div class="form-group">
          <div class="form-field full">
            <label for="opcaoPF">Vincular Pessoa Física:<span class="obrigatorio-icone">*</span></label>
            <select id="opcaoPF" required>
              <option value="">Selecione...</option>
              <option value="associar">Associar PF já cadastrada</option>
              <option value="cadastrar">Cadastrar nova PF</option>
            </select>
          </div>
          <div id="boxPF" class="hidden">
            <div class="form-field full">
              <label for="pfSelect">Selecionar PF:</label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <select id="pfSelect" style="width: 100%; padding-right: 45px;">
                  <option value="">Selecione uma PF</option>
                  <!-- Opções serão carregadas via JS -->
                </select>
                <button type="button" class="btn-icone" id="atualizarPFBtn" title="Atualizar lista" style="order:3;"><i class="fas fa-sync"></i></button>
                <button type="button" class="btn-icone" id="editarPFBtn" title="Editar Seleção" style="order:2;"><i class="fas fa-pen"></i></button>
                <button type="button" class="btn-icone" id="confirmarPFBtn" title="Confirmar Seleção" style="order:1;"><i class="fas fa-check"></i></button>
              </div>
              <div id="pf-feedback" style="color: #a80000; font-size: 13px; margin-top: 2px;"></div>
            </div>
          </div>
          <div id="resumoPF" class="form-field full hidden">
            <div class="campo-resumo" style="display: flex; align-items: center; gap: 8px;">
              <input type="text" id="pfResumoTexto" readonly style="background-color: #f8f9fa; width: calc(100% - 45px);">
              <button type="button" class="btn-icone" id="editarPFBtn" title="Editar Seleção"><i class="fas fa-pen"></i></button>
            </div>
            <input type="hidden" name="pessoa_fisica_id" id="pfInputFinal">
            <input type="hidden" name="nome" id="pfNomeFinal">
          </div>
          <div class="form-row">
            <div class="form-field half">
              <label for="cpf">CPF:<span class="obrigatorio-icone">*</span></label>
              <input type="text" id="cpf" name="cpf" required maxlength="14" style="width: 100%; box-sizing: border-box;" readonly />
              <div id="cpf-feedback" style="color: #a80000; font-size: 13px; margin-top: 2px;"></div>
            </div>
            <div class="form-field half">
              <label for="telefone">Telefone:<span class="obrigatorio-icone">*</span></label>
              <input type="text" id="telefone" name="telefone" required maxlength="16" style="width: 100%; box-sizing: border-box;" readonly />
              <div id="telefone-feedback" style="color: #a80000; font-size: 13px; margin-top: 2px;"></div>
            </div>
          </div>
          <div class="form-field full">
            <label for="email">E-mail:<span class="obrigatorio-icone">*</span></label>
            <input type="email" id="email" name="email" required style="width: 100%; box-sizing: border-box;" readonly />
            <div id="email-feedback" style="color: #a80000; font-size: 13px; margin-top: 2px;"></div>
          </div>
        </div>
        <div class="form-field full">
          <label for="tipo_usuario">
            Tipo de Usuário:
            <span class="obrigatorio-icone">*</span>
            <span class="check-icone">&#10003;</span>
          </label>
          <select id="tipo_usuario" name="tipo" required style="width: 100%; box-sizing: border-box;">
            <option value="">Selecione o tipo de usuário</option>
            <option value="analista">Analista</option>
            <option value="coordenador">Coordenador</option>
          </select>
          <div id="tipo-feedback" style="color: #a80000; font-size: 13px; margin-top: 2px;"></div>
        </div>
      </div>
      <!-- INFORMAÇÕES PROFISSIONAIS -->
      <div class="form-section">
      <h3>Informações Profissionais</h3>
      <div class="form-group">
        <!-- 1. Instituição -->
        <div class="form-field full" id="instituicao-container">
        <label for="instituicao">Instituição:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="instituicao" name="instituicao" required>
          <option value="">Selecione...</option>
          <option value="DER/SP">DER/SP</option>
        </select>
        </div>
        <!-- 2. Tipo de Lotação -->
        <div class="form-field full hidden" id="tipo-lotacao-container">
        <label for="tipo_lotacao">Tipo de Lotação:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="tipo_lotacao" name="tipo_lotacao" required>
          <option value="">Selecione...</option>
          <option value="sede">Sede</option>
          <option value="regional">Regional</option>
        </select>
        </div>
        <!-- 3. Hierarquia Sede -->
        <div class="form-field full hidden" id="sede-hierarquia-container">
        <label for="sede_hierarquia">Hierarquia:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="sede_hierarquia" name="sede_hierarquia" required></select>
        </div>
        <!-- Diretoria (aparece ao selecionar Diretorias em Hierarquia) -->
        <div class="form-field full hidden" id="sede-diretoria-container">
        <label for="sede_diretoria">Diretoria:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="sede_diretoria" name="sede_diretoria" required></select>
        </div>
        <!-- Coordenadoria Geral (aparece ao selecionar Diretoria) -->
        <div class="form-field full hidden" id="sede-coordenadoria-geral-container">
        <label for="sede_coordenadoria_geral">Coordenadoria Geral:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="sede_coordenadoria_geral" name="sede_coordenadoria_geral" required></select>
        </div>
        <!-- Coordenadoria (aparece ao selecionar Coordenadoria Geral) -->
        <div class="form-field full hidden" id="sede-coordenadoria-container">
        <label for="sede_coordenadoria">Coordenadoria:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="sede_coordenadoria" name="sede_coordenadoria" required></select>
        </div>
        <div class="form-field full hidden" id="sede-setor-container">
        <label for="sede_setor">Setor:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <select id="sede_setor" name="sede_setor" required></select>
      </div>
      <!-- 5. E-mail, Telefone, Ramal -->
      <div class="form-row">
        <div class="form-field half">
          <label for="email_institucional">E-mail Institucional:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
          <input type="email" id="email_institucional" name="email_institucional" required style="width: 100%; box-sizing: border-box;" />
        </div>
        <div class="form-field half">
          <label for="telefone_institucional">Telefone Institucional:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
          <input type="text" id="telefone_institucional" name="telefone_institucional" required maxlength="16" style="width: 100%; box-sizing: border-box;" />
          <div id="msg-telefone-institucional" style="display:none; color:red; font-size:13px;"></div>
        </div>
      </div>
      <div class="form-field full">
        <label for="ramal">Ramal:<span class="obrigatorio-icone">*</span><span class="check-icone">&#10003;</span></label>
        <input type="text" id="ramal" name="ramal" required maxlength="10" style="width: 100%; box-sizing: border-box;" />
      </div>
    </div>
  </div>      <!-- INFORMAÇÕES DE ACESSO AO SISTEMA -->
  <div class="form-section">
    <h3>Informações de Acesso ao Sistema</h3>
    <div class="form-group">
      <div class="form-field full">
        <label for="senha" class="required">Senha:</label>
        <div style="position: relative;">
          <input type="password" id="senha" name="senha" required class="senha-input" style="padding-right: 40px;" />
          <span onclick="toggleSenha('senha')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">👁️</span>
        </div>
        <div id="regrasSenha" class="senha-regras">
          <div id="regra1">• No mínimo 5 caracteres</div>
          <div id="regra2">• Letras maiúsculas</div>
          <div id="regra3">• Letras minúsculas</div>
          <div id="regra4">• Números</div>
          <div id="regra5">• Caracteres especiais</div>
        </div>
      </div>
      
      <div class="form-field full">
        <label for="confirmar_senha" class="required">Confirmar Senha:</label>
        <div style="position: relative;">
          <input type="password" id="confirmar_senha" name="confirmar_senha" required class="senha-input" style="padding-right: 40px;" />
          <span onclick="toggleSenha('confirmar_senha')" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;">👁️</span>
        </div>
        <div id="mensagemSenha" class="senha-msg"></div>
      </div>
    </div>
  </div>

  <button type="submit" class="botao-fad" disabled> Cadastrar </button>
  <div id="sucessoBox" style="display:none; text-align:center; margin-top:18px;"></div>
  <div id="erroBox" style="display:none; text-align:center; margin-top:18px;"></div>
  <div id="okBtnContainer" style="text-align:center; margin-top:10px; display:none;">
    <button type="button" class="ok-btn" id="okBtn">OK</button>
  </div>
</form>

<div style="text-align:center; margin-top: 30px;">
  <a href="/boas-vindas" class="menu-link" style="background:#004080; color:#fff; text-decoration:none; padding:10px 22px; border-radius:6px; font-size:16px; font-weight:500; display:inline-block;">Página inicial</a>
</div>

<div id="sucessoBox">Cadastro realizado com sucesso!</div>
<div id="erroBox"></div>
</div>  <script src="/static/js/formatacao_valores_campos/formatacao_cpf.js"></script>
<script src="/static/js/formatacao_valores_campos/formatacao_telefone.js"></script>
<script src="/static/js/formatacao_valores_campos/formatacao_email.js"></script>
<script src="/static/js/formatacao_valores_campos/formatacao_email_institucional.js"></script>
<script src="/static/js/formatacao_valores_campos/formatacao_ramal.js"></script>
<script src="/static/js/cd_usuario/formulario_usuario_unificado.js"></script>
<script src="/static/js/cd_usuario/logicas_listas_infos_pessoais.js"></script>
<script src="/static/js/cd_usuario/logicas_listas_infos_profissionais.js"></script>
<script>
        // Carregar lista de PFs automaticamente ao selecionar "associar"
        document.getElementById('opcaoPF').addEventListener('change', function() {
          if (this.value === 'associar') {
            document.getElementById('boxPF').classList.remove('hidden');
            fetch('/cadastro/pfs/json').then(r => r.json()).then(pfs => {
              const pfSelect = document.getElementById('pfSelect');
              pfSelect.innerHTML = '<option value="">Selecione uma PF</option>';
              pfs.forEach(pf => {
                pfSelect.innerHTML += `<option value="${pf.id}" data-cpf="${pf.cpf}" data-email="${pf.email}" data-telefone="${pf.telefone}" data-nome="${pf.nome}">${pf.nome} (${pf.cpf})</option>`;
              });
            });
          } else {
            document.getElementById('boxPF').classList.add('hidden');
          }
        });
        // Seleção de PF preenche campos, aplica máscaras e validação
        document.getElementById('pfSelect').addEventListener('change', function() {
          const opt = this.options[this.selectedIndex];
          const cpf = document.getElementById('cpf');
          const email = document.getElementById('email');
          const tel = document.getElementById('telefone');
          cpf.value = opt.getAttribute('data-cpf') || '';
          email.value = opt.getAttribute('data-email') || '';
          tel.value = opt.getAttribute('data-telefone') || '';
          document.getElementById('pfResumoTexto').value = opt.getAttribute('data-nome') || '';
          document.getElementById('pfInputFinal').value = opt.value;
          document.getElementById('pfNomeFinal').value = opt.getAttribute('data-nome') || '';
          document.getElementById('resumoPF').classList.remove('hidden');
          // Aplica máscara de CPF
          let v = cpf.value.replace(/\D/g, '');
          if (v.length > 11) v = v.slice(0, 11);
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
          cpf.value = v;
          // Aplica máscara de telefone
          let t = tel.value.replace(/\D/g, '');
          if (t.length > 11) t = t.slice(0, 11);
          if (t.length === 11) {
            t = t.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
          } else if (t.length === 10) {
            t = t.replace(/(\d{2})(\d{4})(\d{4})/, "($1) $2-$3");
          }
          tel.value = t;
          // Validação visual de e-mail
          const emailFeedback = document.getElementById('email-feedback');
          const emailRegex = /^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$/;
          if (email.value && !emailRegex.test(email.value)) {
            emailFeedback.innerText = 'E-mail inválido';
          } else {
            emailFeedback.innerText = '';
          }
        });
        // Botão confirmar: bloqueia seleção, mostra resumo e botão editar, aplica máscaras
        document.getElementById('confirmarPFBtn').addEventListener('click', function() {
          document.getElementById('boxPF').classList.add('hidden');
          document.getElementById('resumoPF').classList.remove('hidden');
          document.getElementById('editarPFBtn').style.display = 'inline-block';
          // Aplica máscara de CPF
          let cpf = document.getElementById('cpf');
          let v = cpf.value.replace(/\D/g, '');
          if (v.length > 11) v = v.slice(0, 11);
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
          cpf.value = v;
          // Aplica máscara de telefone
          let tel = document.getElementById('telefone');
          let t = tel.value.replace(/\D/g, '');
          if (t.length > 11) t = t.slice(0, 11);
          if (t.length === 11) {
            t = t.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
          } else if (t.length === 10) {
            t = t.replace(/(\d{2})(\d{4})(\d{4})/, "($1) $2-$3");
          }
          tel.value = t;
        });
        // Botão editar: limpa tudo e reinicia fluxo
        document.getElementById('editarPFBtn').addEventListener('click', function() {
          document.getElementById('resumoPF').classList.add('hidden');
          document.getElementById('boxPF').classList.remove('hidden');
          document.getElementById('pfSelect').selectedIndex = 0;
          document.getElementById('cpf').value = '';
          document.getElementById('email').value = '';
          document.getElementById('telefone').value = '';
          document.getElementById('pfResumoTexto').value = '';
          document.getElementById('pfInputFinal').value = '';
          document.getElementById('pfNomeFinal').value = '';
          document.getElementById('cpf-feedback').innerText = '';
          document.getElementById('telefone-feedback').innerText = '';
          document.getElementById('email-feedback').innerText = '';
        });
        // Máscaras e validação visual ao digitar
        document.getElementById('cpf').addEventListener('input', function() {
          let v = this.value.replace(/\D/g, '');
          if (v.length > 11) v = v.slice(0, 11);
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d)/, "$1.$2");
          v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
          this.value = v;
          // Validação visual
          const feedback = document.getElementById('cpf-feedback');
          if (v.length < 14) feedback.innerText = 'CPF incompleto';
          else feedback.innerText = '';
        });
        document.getElementById('telefone').addEventListener('input', function() {
          let t = this.value.replace(/\D/g, '');
          if (t.length > 11) t = t.slice(0, 11);
          if (t.length === 11) {
            t = t.replace(/(\d{2})(\d{5})(\d{4})/, "($1) $2-$3");
          } else if (t.length === 10) {
            t = t.replace(/(\d{2})(\d{4})(\d{4})/, "($1) $2-$3");
          }
          this.value = t;
          // Validação visual
          const feedback = document.getElementById('telefone-feedback');
          if (t.length < 10) feedback.innerText = 'Telefone incompleto';
          else feedback.innerText = '';
        });
        document.getElementById('email').addEventListener('input', function() {
          const emailFeedback = document.getElementById('email-feedback');
          const emailRegex = /^[\w\.-]+@[\w\.-]+\.[a-zA-Z]{2,}$/;
          if (this.value && !emailRegex.test(this.value)) {
            emailFeedback.innerText = 'E-mail inválido';
          } else {
            emailFeedback.innerText = '';
          }
        });
        // Validação de duplicidade de perfil
        function checarDuplicidadePerfil() {
          const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
          const tipo = document.getElementById('tipo_usuario').value;
          if (cpf.length === 11 && tipo) {            fetch(`/usuario/verificar-duplicidade?cpf=${cpf}&tipo=${tipo}`)
              .then(resp => resp.json())
              .then(function(data) {
                const tipoFeedback = document.getElementById('tipo-feedback');
                if (data.duplicado) {
                  tipoFeedback.innerText = 'Já existe um usuário cadastrado com este CPF para este perfil.';
                } else {
                  tipoFeedback.innerText = '';
                }
              });
          }
        }
        document.getElementById('tipo_usuario').addEventListener('change', checarDuplicidadePerfil);
      </script>
</body>
</html>



